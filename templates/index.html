<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>ChatGPT Clone</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <style>
        #response { height: 400px; background: #1a1a1a; color: white; padding: 20px; border-radius: 10px; }
        .user-msg { color: #4ade80; text-align: left; margin-bottom: 10px; }
        .bot-msg { color: #60a5fa; text-align: right; margin-bottom: 10px; }
        #prompt { resize: vertical; }
        .loading { color: #94a3b8; font-style: italic; }
    </style>
</head>
<body class="bg-dark text-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <h1 class="text-center mb-4 text-white">ðŸ¤– ChatGPT Clone</h1>
                
                <!-- Chat History -->
                <div id="response" class="mb-4"></div>
                
                <!-- Input Form -->
                <form id="chatForm">
                    <div class="input-group">
                        <textarea class="form-control bg-secondary text-white border-white" 
                                  id="prompt" name="prompt" rows="2" 
                                  placeholder="Type your message here... (Enter to send)"></textarea>
                        <button class="btn btn-primary" type="submit">
                            <i class="bi bi-send"></i> Send
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // Enter key to send (Shift+Enter for new line)
            $('#prompt').on('keydown', function(event) {
                if (event.keyCode === 13 && !event.shiftKey) {
                    event.preventDefault();
                    $('#chatForm').submit();
                }
            });

            // Form submit handler
            $('#chatForm').on('submit', function(event) {
                event.preventDefault();
                
                const prompt = $('#prompt').val().trim();
                if (!prompt) return;

                const time = new Date().toLocaleTimeString();
                
                // Add user message
                $('#response').append(`
                    <div class="user-msg">
                        <small class="opacity-75">${time}</small><br>
                        <strong>You:</strong> ${prompt}
                    </div>
                `);
                
                // Clear input + scroll to bottom
                $('#prompt').val('');
                $('#response').scrollTop($('#response')[0].scrollHeight);
                
                // Add loading indicator
                const loadingId = 'loading-' + Date.now();
                $('#response').append(`
                    <div class="bot-msg" id="${loadingId}">
                        <small class="opacity-75">${time}</small><br>
                        <strong>Bot:</strong> <span class="loading">Typing...</span>
                    </div>
                `);
                $('#response').scrollTop($('#response')[0].scrollHeight);
                
                // AJAX call to backend
                $.ajax({
                    url: '/',
                    type: 'POST',
                    data: {prompt: prompt},
                    dataType: 'json',
                    success: function(data) {
                        // Remove loading
                        $(`#${loadingId}`).remove();
                        
                        // Add bot response
                        $('#response').append(`
                            <div class="bot-msg">
                                <small class="opacity-75">${time}</small><br>
                                <strong>Bot:</strong> ${data.response}
                            </div>
                        `);
                        $('#response').scrollTop($('#response')[0].scrollHeight);
                    },
                    error: function() {
                        $(`#${loadingId}`).html('<strong>Error:</strong> Something went wrong. Try again.');
                    }
                });
            });
        });
    </script>
</body>
</html>
